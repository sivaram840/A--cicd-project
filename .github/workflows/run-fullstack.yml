name: Run Fullstack App (Docker Compose)

on:
  # Run manually from the Actions tab
  workflow_dispatch:

jobs:
  fullstack-run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Show project structure
        run: ls -R

      # Uses your existing docker-compose.yml exactly as it is
      - name: Build & start containers
        run: |
          docker-compose down || true
          docker-compose up --build -d
          echo "Running containers:"
          docker ps

      # Give containers some time to start
      - name: Wait for services to start
        run: sleep 40

      # Optional: collect logs for demo/debug
      - name: Show docker-compose logs
        run: docker-compose logs --tail=100

      # Always stop containers at the end
      - name: Stop containers
        if: always()
        run: docker-compose down
